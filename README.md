# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Архитектура приложения
Код приложения разделён на слои согласно парадигме MVP:
- Слой представления - отвечает за отображение данных на странице
- Слой данных - отвечает за храниение и изменение данных
- Перезнтер - отвечает за связь представления и данных

## Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля:

- `readonly baseUrl: string` - базовый url для api
- `protected options: RequestInit`- объект с настройками для формирования запроса.
- 
Параметры в конструкторе:

- `baseUrl: string` - базовый url для api
- `options: RequestInit` - объект с настройками для формирования запроса.

Методы:

- `protected handleResponse(response: Response): Promise<object>` - обрабатывает ответа с сервера. Если ответ с сервера пришел, то возвращается его в формате json, в противном случае формирует ошибку
- `get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.

Поля:

- `_events: Map<EventName, Set<Subscriber>>` - хранит события в виде Map, где ключом является строка или регулярное выражение, а значением сет коллбэков.
- 
Методы, геттеры и сеттеры:

- `on<T extends object>(eventName: EventName, callback: (event: T) => void)` - подписка на событие
- `off(eventName: EventName, callback: Subscriber)` - отписка от события
- `emit<T extends object>(eventName: string, data?: T)` - инициализация события
- `onAll(callback: (event: EmitterEvent) => void)` - подписаться на все события (выполнить коллбек на любое событие)
- `offAll()` - для сброса событий
- `trigger<T extends object>(eventName: string, context?: Partial<T>)` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.


# Описание интерфейсов и типов данных

## Интерфейсы

### Интерфейс продукта: `IProductItem`
Описание продукта в каталоге.
- `id` (string): Уникальный идентификатор продукта.
- `description` (string): Описание продукта.
- `image` (string): URL изображения продукта.
- `title` (string): Название продукта.
- `category` (string): Категория продукта.
- `price` (number): Цена продукта.

### Интерфейс списка продуктов: `IProductItemData`
Содержит массив продуктов.
- `products` (IProductItem[]): Массив объектов `IProductItem`.

### Интерфейс корзины: `IBasketData`
Управляет состоянием корзины.
- `goods` (IProductItem[]): Массив товаров в корзине.
- `total` (number): Общая стоимость товаров в корзине.
- `isInBasket(id: string): boolean`: Проверяет, есть ли продукт в корзине по его `id`.
- `addToBasket(card: IProductItem): void`: Добавляет продукт в корзину.
- `removeFromBasket(id: string): void`: Удаляет продукт из корзины по его `id`.
- `clearBasket(): void`: Очищает корзину.
- `getGoodsNumber(): number`: Возвращает количество товаров в корзине.
- `getTotal(): number`: Возвращает общую стоимость товаров в корзине.
- `getIdsOfGoods(): string[]`: Возвращает массив идентификаторов товаров в корзине.

### Интерфейс API приложения: `IAppApi`
Методы для взаимодействия с API.
- `getCards(): Promise<IProductItem[]>`: Получает список продуктов.
- `getCardById(id: string): Promise<IProductItem>`: Получает продукт по его `id`.
- `postOrder(order: IOrder): Promise<TOrderSuccess>`: Отправляет заказ и возвращает результат.

### Интерфейс массива продуктов: `IProductList`
Содержит информацию о продуктах в виде массива идентификаторов.
- `total` (number): Общее количество продуктов.
- `items` (string[]): Массив идентификаторов продуктов.

### Интерфейс заказа: `IOrder`
Описание заказа.
- `payment` (PaymentMethod): Метод оплаты.
- `email` (string): Электронная почта пользователя.
- `address` (string): Адрес пользователя.
- `phone` (string): Телефонный номер пользователя.
- `total` (number): Общая стоимость заказа.
- `items` (string[]): Массив идентификаторов товаров в заказе.

### Интерфейс успешного заказа: `IOrderSuccess`
Результат успешного заказа.
- `orderSuccess` (TOrderSuccess): Информация о заказе.

### Интерфейс модального окна: `IModal`
Описание модального окна.
- `content` (HTMLElement): Контент модального окна.
- `buttonClose` (HTMLButtonElement): Кнопка закрытия модального окна.
- `open(): void`: Открывает модальное окно.
- `close(): void`: Закрывает модальное окно.

### Интерфейс представления карточки: `IProduct`
Представление продукта.
- `id` (string): Уникальный идентификатор продукта.
- `title` (string): Название продукта.
- `price` (string): Цена продукта.
- `image` (string): URL изображения продукта.
- `description` (string): Описание продукта.

### Интерфейс представления корзины: `IBasket`
Представление корзины.
- `cards` (HTMLElement[]): Массив элементов корзины.
- `total` (number): Общая стоимость товаров в корзине.
- `emptyCheck` (boolean): Проверка на пустоту корзины.

### Интерфейс представления продукта в корзине: `IProductBasket`
Представление продукта в корзине.
- `index` (number): Индекс продукта в корзине.

### Интерфейс представления формы: `IForm`
Представление формы.
- `valid` (boolean): Статус валидации формы.
- `errorMessage` (string): Сообщение об ошибке.
- `clear(): void`: Очищает форму.

### Интерфейс представления формы заказа: `IFormOrder`
Представление формы заказа.
- `orderPayment` (TPlacingOrderInfo): Информация о платеже заказа.
- `resetButtons(): void`: Сбрасывает состояние кнопок формы.
- `valid` (boolean): Статус валидации формы заказа.

### Интерфейс представления контактов пользователя: `IFormUserContacts`
Представление контактной информации пользователя.
- `userInfo` (TUserInfo): Информация о пользователе.

### Интерфейс представления успешной покупки: `ISuccess`
Представление сообщения об успешной покупке.
- `message` (TOrderSuccess): Информация о заказе.

### Интерфейс представления каталога: `IPage`
Представление страницы каталога.
- `counter` (number): Счётчик продуктов.
- `catalog` (HTMLElement[]): Массив элементов каталога.

### Интерфейс каталога продуктов: `IProductCatalog`
Фильтрация продуктов по категории.
- `category` (string): Категория продуктов.

### Интерфейс предварительного просмотра карточки: `IViewCardPreview`
Предварительный просмотр карточки продукта.
- `category` (string): Категория продукта.
- `invalidPrice` (boolean): Неверная цена.
- `buttonValidation` (boolean): Валидация кнопки.

### Интерфейс предварительного просмотра продукта: `IProductPreview`
Предварительный просмотр продукта.
- `category` (string): Категория продукта.
- `invalidPrice` (boolean): Неверная цена.
- `buttonValidation` (boolean): Валидация кнопки.

## Типы данных

### Типы успеха заказа: `TOrderSuccess`
Информация о заказе.
- `items` (string[]): Массив идентификаторов товаров.
- `total` (number): Общая стоимость заказа.

### Метод оплаты: `PaymentMethod`
Методы оплаты.
- `'cash'`: Наличные.
- `'card'`: Карта.

### Информация о пользователе: `TUserInfo`
Контактная информация пользователя.
- `phone` (string): Телефонный номер.
- `email` (string): Электронная почта.

### Информация для оформления заказа: `TPlacingOrderInfo`
Информация для оформления заказа.
- `address` (string): Адрес пользователя.
- `payment` (PaymentMethod): Метод оплаты.

### Информация о корзине: `TBasket`
Состояние корзины.
- `cards` (HTMLElement[]): Массив элементов корзины.
- `total` (number): Общая стоимость товаров в корзине.
- `emptyCheck` (boolean): Проверка на пустоту корзины.

### Информация о корзине для модального окна: `TBasketInfo`
Информация о корзине для модального окна.
- `total` (number): Общая стоимость товаров.
- `items` (string[]): Массив идентификаторов товаров.

### Тип модального окна: `TModal`
Информация о модальном окне.
- `content` (HTMLElement): Контент модального окна.

### Предварительный просмотр продукта: `TProductPreview`
Предварительный просмотр продукта.
- `id` (string): Уникальный идентификатор продукта.
- `title` (string): Название продукта.
- `price` (number): Цена продукта.
- `category` (string): Категория продукта.
- `image` (string): URL изображения продукта.
- `invalidPrice` (boolean): Неверная цена.
- `buttonValidation` (boolean): Валидация кнопки.

### Продукт в корзине: `TProductBasket`
Продукт в корзине.
- `id` (string): Уникальный идентификатор продукта.
- `title` (string): Название продукта.
- `price` (number): Цена продукта.
- `index` (number): Индекс продукта в корзине.

### Классы категорий: `TCategoryClassNames`
Классы CSS для категорий продуктов.
- `'card__category_soft'`
- `'card__category_other'`
- `'card__category_additional'`
- `'card__category_button'`
- `'card__category_hard'`

### Классы категорий: `TCategoryClasses`
Запись классов категорий.
- `string` (TCategoryClassNames): Класс для категории.

### Каталог продуктов: `TProductCatalog`
Каталог продуктов.
- `id` (string): Уникальный идентификатор продукта.
- `title` (string): Название продукта.
- `price` (number): Цена продукта.
- `category` (string): Категория продукта.
- `image` (string): URL изображения продукта.

### Форма: `TForm`
Форма.
- `valid` (boolean): Статус валидации формы.
- `errorMessage` (string): Сообщение об ошибке.

### Форма контактов: `TFormContacts`
Контактная информация в форме.
- `email` (string): Электронная почта.
- `phone` (string): Телефонный номер.
- `valid` (boolean): Статус валидации формы.

### Оплата: `TPayment`
Информация о платеже.
- `payment` (PaymentMethod): Метод оплаты.

### Форма заказа: `TFormOrder`
Форма заказа.
- `payment` (TPayment): Информация о платеже.
- `address` (string): Адрес пользователя.
- `valid` (boolean): Статус валидации формы.

### Идентификатор: `TId`
Идентификатор.
- `id` (string): Уникальный идентификатор.

# Слой данных Model

# Файл `basketData.ts`

## Описание

Файл `basketData.ts` содержит реализацию класса `ShoppingCart`, который управляет состоянием корзины покупок. Этот класс реализует интерфейс `IBasketData` и использует события для оповещения о изменениях в корзине.

## Класс `ShoppingCart`

### Свойства
- **`_goods`**: Массив товаров (`IProductItem[]`), находящихся в корзине. Доступ к этому свойству осуществляется через геттер и сеттер.
- **`total`**: Общая сумма товаров в корзине. Инициализируется значением `0`.
- **`events`**: Экземпляр класса `IEvents`, используемый для управления событиями.

### Конструктор
- **`constructor(events: IEvents)`**: Создаёт экземпляр корзины с заданным объектом `events`.

### Методы

- **`get goods()`**: Геттер для доступа к массиву товаров в корзине.
- **`set goods(cards: IProductItem[])`**: Сеттер для установки массива товаров в корзине.

- **`isInBasket(id: string): boolean`**: Проверяет наличие товара в корзине по его идентификатору `id`.

- **`checkBasket(id: string)`**: Проверяет, есть ли товар в корзине, и если он есть, вызывает событие `addToBasket:disabled`.

- **`addToBasket(card: IProductItem)`**: Добавляет товар в корзину и обновляет общую стоимость. Вызывает событие `basketData:changed`.

- **`removeFromBasket(id: string)`**: Удаляет товар из корзины по идентификатору `id`. Вызывает событие `basketData:changed`.

- **`clearBasket()`**: Очищает корзину и сбрасывает общую сумму. Вызывает событие `basketData:changed`.

- **`getGoodsNumber(): number`**: Возвращает общее количество товаров в корзине.

- **`getTotal(): number`**: Возвращает общую стоимость всех товаров в корзине.

- **`getIdsOfGoods(): string[]`**: Возвращает массив идентификаторов товаров в корзине.

- **`emptyValidation(): boolean`**: Проверяет, пуста ли корзина, и возвращает `true`, если корзина пустая.

## Зависимости

- **`IBasketData`**: Интерфейс, который реализует класс `ShoppingCart`.
- **`IProductItem`**: Интерфейс, описывающий свойства продукта.
- **`IEvents`**: Интерфейс для работы с событиями, используется для оповещения о изменениях в корзине.

# Файл `orderData.ts`

## Описание

Файл `orderData.ts` содержит реализацию класса `Order`, который управляет данными заказа. Этот класс реализует интерфейс `IOrder` и использует события для оповещения о изменениях.

## Класс `Order`

### Свойства
- **`_payment`**: Метод оплаты (`PaymentMethod`). Приватное свойство.
- **`_email`**: Электронная почта пользователя. Приватное свойство.
- **`_address`**: Адрес пользователя. Приватное свойство.
- **`_phone`**: Телефонный номер пользователя. Приватное свойство.
- **`_total`**: Общая сумма заказа. Приватное свойство.
- **`_items`**: Массив идентификаторов товаров в заказе. Приватное свойство.
- **`events`**: Экземпляр класса `IEvents`, используемый для управления событиями.

### Конструктор
- **`constructor(events: IEvents)`**: Создаёт экземпляр заказа с заданным объектом `events`.

### Методы

- **`set payment(type: PaymentMethod)`**: Устанавливает метод оплаты для заказа.

- **`get payment()`**: Возвращает метод оплаты.

- **`set email(value: string)`**: Устанавливает электронную почту пользователя.

- **`set address(value: string)`**: Устанавливает адрес пользователя.

- **`set phone(value: string)`**: Устанавливает номер телефона пользователя.

- **`set total(value: number)`**: Устанавливает общую сумму заказа.

- **`set items(value: string[])`**: Устанавливает массив идентификаторов товаров в заказе.

- **`get orderFullInfo()`**: Возвращает полную информацию о заказе, включая метод оплаты, электронную почту, телефонный номер, адрес, общую сумму и массив товаров.

## Зависимости

- **`IOrder`**: Интерфейс, который реализует класс `Order`.
- **`PaymentMethod`**: Тип, определяющий методы оплаты (`'cash'` | `'card'`).
- **`IEvents`**: Интерфейс для работы с событиями, используется для оповещения о изменениях (хотя не используется напрямую в методах класса, возможно, его планируется использовать для расширения функциональности).

# Файл `productData.ts`

## Описание

Файл `productData.ts` содержит реализацию класса `ProductItem`, который управляет данными продуктов. Этот класс реализует интерфейс `IProductItemData` и использует события для оповещения об изменениях в продуктах.

## Класс `ProductItem`

### Свойства
- **`_products`**: Приватный массив для хранения данных о продуктах (`IProductItem[]`).
- **`cards`**: Публичный массив, который также хранит данные о продуктах (`IProductItem[]`), используется для доступа к продуктам.
- **`events`**: Экземпляр класса `IEvents`, используемый для управления событиями.

### Конструктор
- **`constructor(events: IEvents)`**: Создаёт экземпляр класса `ProductItem` с заданным объектом `events`.

### Методы

- **`set products(products: IProductItem[])`**: Сеттер для установки массива продуктов. Обновляет как `_products`, так и `cards`, и вызывает событие `cards:changed` для оповещения об изменении продуктов.

- **`get products()`**: Геттер для получения массива продуктов.

- **`getCard(id: string)`**: Возвращает карточку продукта по его идентификатору `id` из массива `cards`.

- **`getProductById(id: string)`**: Возвращает продукт по его идентификатору `id` из массива `_products`.

## Зависимости

- **`IProductItem`**: Интерфейс, описывающий свойства продукта.
- **`IProductItemData`**: Интерфейс, содержащий массив продуктов (`IProductItem[]`).
- **`IEvents`**: Интерфейс для работы с событиями, используется для оповещения о изменениях продуктов.

# Файл `successData.ts`

## Описание

Файл `successData.ts` содержит реализацию класса `Success`, который управляет данными об успешном заказе. Этот класс реализует интерфейс `IOrderSuccess` и использует события для оповещения об изменениях.

## Класс `Success`

### Свойства
- **`_orderSuccess`**: Приватное свойство, которое хранит данные об успешном заказе (`TOrderSuccess`).
- **`events`**: Экземпляр класса `IEvents`, используемый для управления событиями.

### Конструктор
- **`constructor(events: IEvents)`**: Создаёт экземпляр класса `Success` с заданным объектом `events`.

### Методы

- **`set orderSuccess(value: TOrderSuccess)`**: Устанавливает данные об успешном заказе и сохраняет их в приватное свойство `_orderSuccess`.

- **`get orderSuccess()`**: Возвращает данные об успешном заказе, хранящиеся в приватном свойстве `_orderSuccess`.

## Зависимости

- **`IOrderSuccess`**: Интерфейс, который реализует класс `Success`.
- **`TOrderSuccess`**: Тип, определяющий успешный заказ (включает свойства `items` и `total`).
- **`IEvents`**: Интерфейс для работы с событиями, хотя в данном классе не используется напрямую, его наличие предполагает возможность расширения функциональности.

# Слой данных View
# Файл `basket.ts`

## Описание

Файл `basket.ts` содержит реализацию класса `Basket`, который отвечает за представление и управление корзиной покупок в пользовательском интерфейсе. Этот класс наследуется от `View` и реализует интерфейс `IBasket`.

## Класс `Basket`

### Свойства

- **`_cardList`**: DOM элемент, представляющий список товаров, добавленных в корзину (`HTMLUListElement`).

- **`totalCost`**: DOM элемент, отображающий общую стоимость товаров в корзине (`HTMLSpanElement`).

- **`basketToOrder`**: DOM элемент кнопки "Оформить заказ" (`HTMLButtonElement`).

### Конструктор

- **`constructor(container: HTMLElement, events: IEvents)`**: Создаёт экземпляр класса `Basket`, инициализируя DOM элементы и добавляя обработчик события для кнопки "Оформить заказ".

### Методы

- **`set cards(items: HTMLElement[])`**: Устанавливает список товаров в корзине, заменяя содержимое элемента `_cardList`.

- **`set total(value: number)`**: Обновляет отображаемую общую стоимость товаров в корзине, устанавливая текст элемента `totalCost`.

- **`set emptyCheck(state: boolean)`**: Устанавливает состояние кнопки "Оформить заказ". Если корзина пуста (`state` равно `true`), кнопка отключается.

## Зависимости

- **`TBasket`**: Тип данных для корзины.
- **`IBasket`**: Интерфейс, который реализует класс `Basket`.
- **`IEvents`**: Интерфейс для работы с событиями.
- **`View`**: Базовый класс для представления данных на странице.
- **`ensureElement`**: Утилитная функция для безопасного получения DOM элементов.

# Файл `form.ts`

## Описание

Файл `form.ts` содержит абстрактный класс `Form`, который управляет формами в пользовательском интерфейсе. Этот класс наследуется от `View` и реализует интерфейс `IForm`. Класс предназначен для работы с формами, валидацией и обработкой событий.

## Класс `Form<T>`

### Свойства

- **`container`**: DOM элемент формы (`HTMLFormElement`).

- **`inputs`**: Массив всех полей ввода формы (`HTMLInputElement[]`).

- **`submitButton`**: Кнопка отправки формы (`HTMLButtonElement`).

- **`errorSpan`**: Спан для отображения сообщений об ошибках (`HTMLSpanElement`).

### Конструктор

- **`constructor(container: HTMLElement, events: IEvents)`**: Создаёт экземпляр класса `Form`, инициализируя DOM элементы формы и добавляя обработчики событий для кнопки сабмита и полей ввода. 

### Методы

- **`set valid(state: boolean)`**: Устанавливает активное/блокированное состояние кнопки сабмита в зависимости от значения `state`. Если форма валидна (`state` равно `true`), кнопка становится активной; в противном случае — блокируется.

- **`get valid(): boolean`**: Проверяет валидность формы. Возвращает `true`, если все поля ввода содержат данные, и `false` в противном случае.

- **`set errorMessage(value: string)`**: Устанавливает сообщение об ошибке, отображаемое в `errorSpan`.

- **`clear()`**: Очищает форму, сбрасывая её содержимое.

- **`render(data: Partial<T> & TForm)`**: Рендерит форму с предоставленными данными. Обновляет форму и возвращает DOM элемент контейнера.

## Зависимости

- **`IForm`**: Интерфейс, который реализует класс `Form`.
- **`TForm`**: Тип данных для формы, включает свойства `valid` и `errorMessage`.
- **`View`**: Базовый класс для представления данных на странице.
- **`ensureAllElements`**: Утилитная функция для получения всех элементов с заданным классом.
- **`ensureElement`**: Утилитная функция для безопасного получения одного DOM элемента.
- **`IEvents`**: Интерфейс для работы с событиями.

# Файл `formContact.ts`

## Описание

Файл `formContact.ts` содержит реализацию класса `FormContacts`, который управляет формой ввода контактной информации пользователя. Этот класс расширяет абстрактный класс `Form` и реализует интерфейс `TFormContacts`.

## Класс `FormContacts`

### Свойства

- **`emailInput`**: Поле ввода электронной почты (`HTMLInputElement`).

- **`telephoneInput`**: Поле ввода телефонного номера (`HTMLInputElement`).

### Конструктор

- **`constructor(container: HTMLElement, events: IEvents)`**: Создаёт экземпляр класса `FormContacts`, инициализируя поля ввода и добавляя обработчики событий для каждого из них. При вводе данных в поля генерируются события `email:input`, `telephone:input`, и `contacts:valid`.

### Методы

- **`get email()`**: Возвращает значение поля электронной почты.

- **`get phone()`**: Возвращает значение поля телефонного номера.

- **`get valid()`**: Проверяет валидность формы. Возвращает `true`, если оба поля (электронная почта и телефон) заполнены, и очищает сообщение об ошибке. Если одно или оба поля пусты, устанавливает соответствующее сообщение об ошибке и возвращает `false`.

- **`set valid(value: boolean)`**: Устанавливает состояние валидности формы через метод родительского класса `Form`.

## Зависимости

- **`IFormUserContacts`**: Интерфейс для данных формы контактов пользователя.
- **`TFormContacts`**: Тип данных для формы контактов, включает свойства для email и phone.
- **`Form`**: Абстрактный базовый класс для работы с формами.
- **`ensureElement`**: Утилитная функция для безопасного получения одного DOM элемента.
- **`IEvents`**: Интерфейс для работы с событиями.

# Файл `modal.ts`

## Описание

Файл `modal.ts` содержит реализацию класса `Modal`, который управляет отображением и функциональностью модальных окон в пользовательском интерфейсе. Этот класс расширяет базовый класс `View` и реализует интерфейс `IModal`.

## Класс `Modal`

### Свойства

- **`_content`**: Приватное свойство, которое хранит содержимое модального окна (`HTMLElement`).

- **`buttonClose`**: Кнопка для закрытия модального окна (`HTMLButtonElement`).

### Конструктор

- **`constructor(container: HTMLElement, events: IEvents)`**: Создаёт экземпляр класса `Modal`, инициализируя элементы модального окна и добавляя обработчики событий. 
  - Добавляет обработчик события `mouseup` на контейнер модального окна, чтобы закрыть модальное окно при клике вне его содержимого.
  - Инициализирует элементы `_content` и `buttonClose`, а также добавляет обработчик кликов на кнопку закрытия, чтобы закрыть модальное окно.

### Методы

- **`open()`**: Открывает модальное окно. Добавляет класс `modal_active` к контейнеру модального окна и эмитит событие `modal:open`.

- **`close()`**: Закрывает модальное окно. Удаляет класс `modal_active` с контейнера модального окна и эмитит событие `modal:close`.

- **`set content(value: HTMLElement)`**: Устанавливает содержимое модального окна, заменяя текущих дочерние элементы `_content` на переданный элемент.

## Зависимости

- **`IModal`**: Интерфейс, который реализует класс `Modal`.
- **`TModal`**: Тип данных для модального окна, включает свойства для контента и кнопки закрытия.
- **`View`**: Базовый класс для представления данных на странице.
- **`ensureElement`**: Утилитная функция для безопасного получения одного DOM элемента.
- **`IEvents`**: Интерфейс для работы с событиями.

# Файл `orderForm.ts`

## Описание

Файл `orderForm.ts` содержит реализацию класса `FormOrder`, который управляет формой для оформления заказа. Этот класс расширяет абстрактный класс `Form` и реализует интерфейс `IFormOrder`. Класс позволяет пользователю выбирать метод оплаты (онлайн или при получении) и вводить адрес доставки.

## Класс `FormOrder`

### Свойства

- **`buttonsContainer`**: Контейнер для кнопок выбора метода оплаты (`HTMLDivElement`).

- **`buttonOnline`**: Кнопка для выбора онлайн-оплаты (`HTMLButtonElement`).

- **`buttonOnDelivery`**: Кнопка для выбора оплаты при получении (`HTMLButtonElement`).

- **`addressInput`**: Поле ввода адреса доставки (`HTMLInputElement`).

### Конструктор

- **`constructor(container: HTMLFormElement, events: IEvents)`**: Создаёт экземпляр класса `FormOrder`, инициализируя элементы формы и добавляя обработчики событий:
  - Инициализирует кнопки выбора метода оплаты и поле ввода адреса.
  - Добавляет обработчики кликов на кнопки для выбора метода оплаты и изменение состояния активности кнопок.
  - Добавляет обработчик события ввода в поле адреса для обновления состояния формы.

### Методы

- **`getButtonActive()`**: Возвращает активную кнопку выбора метода оплаты (`HTMLButtonElement`). Если активна кнопка онлайн-оплаты, возвращает её, иначе возвращает кнопку оплаты при получении.

- **`resetButtons()`**: Сбрасывает активный статус кнопок, убирая класс активности с обеих кнопок.

- **`set payment(value: PaymentMethod | null)`**: Устанавливает метод оплаты, меняя активность кнопок в зависимости от значения. Устанавливает активную кнопку и обновляет значение метода оплаты.

- **`get payment()`**: Возвращает метод оплаты в виде строки (`PaymentMethod`), соответствующий активной кнопке. Если ни одна кнопка не активна, возвращает `null`.

- **`get address()`**: Возвращает значение поля ввода адреса.

- **`get valid()`**: Проверяет валидность формы. Возвращает `true`, если поле адреса заполнено и выбран метод оплаты. Устанавливает соответствующее сообщение об ошибке, если данные невалидны.

- **`set valid(value: boolean)`**: Устанавливает состояние валидности формы через метод родительского класса `Form`.

- **`clear()`**: Очищает форму и сбрасывает состояние кнопок.

## Зависимости

- **`IFormOrder`**: Интерфейс для данных формы заказа, включая метод оплаты и адрес доставки.
- **`PaymentMethod`**: Тип данных для метода оплаты (онлайн или при получении).
- **`TFormOrder`**: Тип данных для формы заказа, включает свойства для метода оплаты и адреса.
- **`TPlacingOrderInfo`**: Тип данных для информации о заказе.
- **`Form`**: Абстрактный базовый класс для работы с формами.
- **`ensureElement`**: Утилитная функция для безопасного получения одного DOM элемента.
- **`IEvents`**: Интерфейс для работы с событиями.

# Файл `page.ts`

## Описание

Файл `page.ts` содержит реализацию класса `Page`, который управляет отображением страницы каталога товаров. Этот класс расширяет базовый класс `View` и реализует интерфейс `IPage`. Класс предоставляет методы для управления содержимым каталога, отображением счетчика товаров в корзине и блокировкой экрана.

## Класс `Page`

### Свойства

- **`_gallery`**: DOM элемент, содержащий галерею товаров (`HTMLElement`).

- **`buttonBasket`**: Кнопка для открытия корзины (`HTMLButtonElement`).

- **`_counter`**: DOM элемент для отображения счетчика товаров в корзине (`HTMLSpanElement`).

- **`screen`**: Основной контейнер страницы для управления блокировкой экрана (`HTMLDivElement`).

### Конструктор

- **`constructor(container: HTMLElement, events: IEvents)`**: Создаёт экземпляр класса `Page`, инициализируя элементы страницы и добавляя обработчики событий:
  - Инициализирует кнопку для открытия корзины и добавляет обработчик клика для эмита события `viewBasket:open`.
  - Инициализирует счетчик товаров в корзине.
  - Инициализирует контейнер галереи и основной контейнер страницы.

### Методы

- **`set catalog(viewCards: HTMLElement[])`**: Устанавливает содержимое каталога товаров, заменяя текущие элементы на переданные `viewCards`. Используется для отображения карточек товаров в галерее.

- **`set counter(value: number)`**: Устанавливает значение счетчика товаров в корзине. Обновляет текстовое содержимое элемента `_counter` на переданное значение.

- **`lockScreen(value: boolean)`**: Управляет блокировкой экрана страницы. Если `value` равно `true`, добавляет класс `page__wrapper_locked` к элементу `screen`, блокируя экран. Если `value` равно `false`, удаляет класс, разблокируя экран. Логи выводятся в консоль для отслеживания состояния экрана.

## Зависимости

- **`IPage`**: Интерфейс для представления страницы, включающий методы и свойства для управления отображением.
- **`ensureElement`**: Утилитная функция для безопасного получения одного DOM элемента.
- **`IEvents`**: Интерфейс для работы с событиями.
- **`View`**: Базовый класс для представления, обеспечивающий основные методы и свойства для работы с DOM элементами.

# Файл `product.ts`

## Описание

Файл `product.ts` содержит реализацию абстрактного класса `Product`, который управляет отображением карточки товара на странице. Этот класс расширяет базовый класс `View` и реализует интерфейс `IProduct`. Он предоставляет методы и свойства для работы с различными аспектами карточки товара, такими как идентификатор, заголовок, цена, изображение, описание и категория.

## Класс `Product<T>`

### Свойства

- **`_id`**: Идентификатор товара (`string`).

- **`_title`**: DOM элемент, содержащий заголовок товара (`HTMLHeadingElement`).

- **`_price`**: DOM элемент, содержащий цену товара (`HTMLSpanElement`).

- **`_image`**: DOM элемент для изображения товара (`HTMLImageElement | null`).

- **`_description`**: DOM элемент для описания товара (`HTMLParagraphElement | null`).

- **`_category`**: DOM элемент для категории товара (`HTMLSpanElement | null`).

### Конструктор

- **`constructor(container: HTMLElement, events: IEvents)`**: Создаёт экземпляр класса `Product`, инициализируя элементы страницы для отображения карточки товара и устанавливая обработчики событий. Ищет и сохраняет DOM элементы, такие как заголовок, цену, изображение, описание и категорию товара.

### Методы и свойства

- **`set id(value: string)`**: Устанавливает идентификатор товара.

- **`get id()`**: Возвращает идентификатор товара.

- **`set title(value: string)`**: Устанавливает заголовок товара в соответствующий DOM элемент.

- **`get title()`**: Возвращает текст заголовка товара.

- **`set price(value: string)`**: Устанавливает цену товара в соответствующий DOM элемент. Форматирует цену с добавлением текста `синапсов` или устанавливает текст `Бесценно`, если цена не указана.

- **`get price()`**: Возвращает текст цены товара.

- **`set image(src: string)`**: Устанавливает изображение товара, если элемент изображения существует. Вызывает метод `setImage` для установки источника изображения.

- **`get image()`**: Возвращает ссылку на изображение товара, если элемент изображения существует.

- **`set description(value: string)`**: Устанавливает текст описания товара в соответствующий DOM элемент, если элемент описания существует.

- **`addClassToCategory(value: string)`**: Добавляет класс к элементу категории товара в зависимости от её значения. Удаляет старые классы категории и добавляет новый класс, основываясь на содержимом `value` и константах из `categories`.

## Зависимости

- **`IProduct`**: Интерфейс для представления товара, включая его свойства и методы.

- **`ensureElement`**: Утилитная функция для безопасного получения одного DOM элемента.

- **`categories`**: Константы, определяющие классы для категорий товаров.

- **`View`**: Базовый класс для представления, обеспечивающий основные методы и свойства для работы с DOM элементами.

# Файл `productCatalog.ts`

## Описание

Файл `productCatalog.ts` содержит реализацию класса `ProductItemCatalogue`, который представляет карточку товара в каталоге продуктов. Этот класс расширяет абстрактный класс `Product` и реализует интерфейс `IProductCatalog`. Он управляет отображением изображения и категории товара и добавляет функциональность для обработки событий на карточке товара.

## Класс `ProductItemCatalogue<TProductCatalog>`

### Свойства

- **`_image`**: DOM элемент для изображения товара (`HTMLImageElement`).

- **`_category`**: DOM элемент для категории товара (`HTMLSpanElement`).

### Конструктор

- **`constructor(container: HTMLElement, events: IEvents)`**: Создаёт экземпляр класса `ProductItemCatalogue`, инициализируя элементы страницы для отображения карточки товара. Ищет и сохраняет DOM элементы для изображения и категории товара, а также добавляет обработчик клика на карточку товара, который вызывает событие `modal-card:open` с идентификатором товара.

### Методы и свойства

- **`protected addCSSClassCategory(value: string)`**: Добавляет CSS класс к элементу категории товара в зависимости от значения `value`. Использует константы из `categories` для определения нужного класса.

- **`set image(src: string)`**: Устанавливает изображение товара. Устанавливает атрибут `src` и `alt` для элемента изображения.

- **`set category(value: string)`**: Устанавливает текст категории товара в соответствующий DOM элемент и добавляет CSS класс для категории, используя метод `addCSSClassCategory`.

- **`get category()`**: Возвращает текст категории товара.

## Зависимости

- **`IProductCatalog`**: Интерфейс для представления каталога товаров, включая его свойства и методы.

- **`ensureElement`**: Утилитная функция для безопасного получения одного DOM элемента.

- **`Product`**: Абстрактный класс для представления карточки товара, предоставляющий базовые методы и свойства.

- **`categories`**: Константы, определяющие CSS классы для категорий товаров.

- **`IEvents`**: Интерфейс для работы с событиями.

# Файл `productInBasket.ts`

## Описание

Файл `productInBasket.ts` содержит реализацию класса `ProductInBasket`, который представляет товар в корзине покупок. Этот класс расширяет абстрактный класс `Product` и реализует интерфейс `IProductBasket`. Класс управляет отображением порядкового номера товара в корзине и кнопкой удаления товара.

## Класс `ProductInBasket<TProductBasket>`

### Свойства

- **`_index`**: DOM элемент для отображения порядкового номера товара (`HTMLSpanElement`).

- **`buttonDelete`**: DOM элемент для кнопки удаления товара из корзины (`HTMLButtonElement`).

### Конструктор

- **`constructor(container: HTMLElement, events: IEvents)`**: Создаёт экземпляр класса `ProductInBasket`, инициализируя элементы страницы для отображения товара в корзине. Ищет и сохраняет DOM элементы для порядкового номера и кнопки удаления товара, а также добавляет обработчик клика на кнопку удаления. При нажатии на кнопку вызывается событие `viewCard:deleteFromBasket`, передающее идентификатор товара.

### Методы и свойства

- **`set index(value: number)`**: Устанавливает порядковый номер товара в корзине. Значение `value` увеличивается на 1 перед установкой текста в элемент `_index`.

- **`get index()`**: Возвращает порядковый номер товара в корзине, преобразуя текстовое содержание элемента `_index` в число.

## Зависимости

- **`IProductBasket`**: Интерфейс для представления товара в корзине, включая его свойства и методы.

- **`ensureElement`**: Утилитная функция для безопасного получения одного DOM элемента.

- **`Product`**: Абстрактный класс для представления карточки товара, предоставляющий базовые методы и свойства.

- **`IEvents`**: Интерфейс для работы с событиями.

# Файл `productPreview.ts`

## Описание

Файл `productPreview.ts` содержит реализацию класса `ProductPreview`, который представляет предварительный просмотр товара на веб-странице. Этот класс отвечает за отображение информации о товаре и управление кнопкой для добавления товара в корзину или удаления из неё. Он реализует интерфейсы `IProductPreview` и `IProductItem`, а также расширяет абстрактный класс `View`.

## Класс `ProductPreview`

### Свойства

- **`buttonBuy`**: DOM элемент для кнопки, предназначенной для добавления товара в корзину или удаления его из корзины (`HTMLButtonElement`).

- **`title`**: Заголовок товара (строка).

- **`category`**: Категория товара (строка).

- **`container`**: Основной контейнер для отображения товара (`HTMLElement`).

- **`price`**: Цена товара (число).

- **`image`**: URL изображения товара (строка).

- **`description`**: Описание товара (строка).

- **`id`**: Идентификатор товара (строка).

### Конструктор

- **`constructor(container: HTMLElement, events: IEvents)`**: Создаёт экземпляр класса `ProductPreview`, инициализируя элементы страницы для отображения предварительного просмотра товара. Ищет и сохраняет DOM элемент кнопки `buttonBuy`, добавляет обработчик события клика на кнопку для добавления товара в корзину или удаления из неё. При нажатии на кнопку вызывается событие `viewCard:addToBasket` или `viewCard:deleteFromBasket` в зависимости от состояния текста кнопки.

### Методы и свойства

- **`set invalidPrice(value: boolean)`**: Устанавливает состояние кнопки `buttonBuy` в зависимости от валидности цены товара. Если цена недействительна, кнопка становится недоступной.

- **`get invalidPrice()`**: Возвращает состояние кнопки `buttonBuy`, является ли она недоступной.

- **`set buttonValidation(value: boolean)`**: Устанавливает текст кнопки `buttonBuy` в зависимости от состояния кнопки и валидности цены. Возможные состояния: 'Не продается', 'Убрать из корзины', 'Купить'.

- **`render(data?: Partial<IProductItem & {invalidPrice: boolean; buttonValidation: boolean}>): HTMLElement`**: Рендерит данные товара, обновляя заголовок, цену, категорию и изображение. Вызывается родительский метод `render` для обновления базовых данных, затем обновляются элементы контейнера и возвращается обновлённый контейнер.

## Зависимости

- **`IProductPreview`**: Интерфейс для представления предварительного просмотра товара, включая свойства и методы.

- **`IProductItem`**: Интерфейс для товара, включающий его свойства.

- **`ensureElement`**: Утилитная функция для безопасного получения одного DOM элемента.

- **`View`**: Абстрактный класс, предоставляющий базовые методы и свойства для работы с представлением.

# Файл `success.ts`

## Описание

Файл `success.ts` содержит реализацию класса `VSuccess`, который отвечает за отображение успешного завершения заказа. Этот класс предоставляет механизм для отображения сообщения об успешной операции и управления кнопкой для закрытия сообщения. Он реализует интерфейс `ISuccess` и расширяет абстрактный класс `View`.

## Класс `VSuccess`

### Свойства

- **`_message`**: DOM элемент для отображения сообщения об успешной операции (`HTMLParagraphElement`).

- **`buttonSuccess`**: DOM элемент кнопки для закрытия сообщения об успешной операции (`HTMLButtonElement`).

### Конструктор

- **`constructor(container: HTMLElement, events: IEvents)`**: Создаёт экземпляр класса `VSuccess`. Ищет и сохраняет DOM элементы для сообщения и кнопки. Добавляет обработчик события клика на кнопку `buttonSuccess`, который вызывает событие `success:submit` через объект `events`.

### Методы и свойства

- **`set message(value: number)`**: Устанавливает текст сообщения, отображая количество списанных "синапсов". Формат сообщения: `Списано ${value} синапсов`.

## Зависимости

- **`ISuccess`**: Интерфейс для описания успешного завершения заказа, включающий свойства и методы.

- **`ensureElement`**: Утилитная функция для безопасного получения одного DOM элемента.

- **`View`**: Абстрактный класс, предоставляющий базовые методы и свойства для работы с представлением.

# Файл `view.ts`

## Описание

Файл `view.ts` содержит абстрактный класс `View`, который служит базовым классом для представлений в приложении. Этот класс предоставляет набор методов для работы с DOM элементами, такими как установка текста, управление видимостью, и обработка событий.

## Класс `View<T>`

### Свойства

- **`container`**: DOM элемент, содержащий текущее представление (`HTMLElement`).

- **`events`**: Объект для управления событиями (`IEvents`).

### Конструктор

- **`constructor(container: HTMLElement, events: IEvents)`**: Инициализирует экземпляр класса `View` и сохраняет ссылку на контейнер и объект для событий.

### Методы и свойства

- **`toggleClass(element: HTMLElement, className: string, method?: boolean)`**: Переключает класс у указанного элемента. Если `method` равно `true`, класс добавляется; если `false` — удаляется.

- **`protected setText(element: HTMLElement, value: unknown)`**: Устанавливает текстовое содержимое элемента. Преобразует значение в строку.

- **`setDisabled(element: HTMLElement, state: boolean)`**: Устанавливает или снимает статус блокировки у элемента. Добавляет атрибут `disabled` при `state` равном `true`, иначе удаляет его.

- **`protected setHidden(element: HTMLElement)`**: Скрывает элемент, устанавливая его `display` в `none`.

- **`protected setVisible(element: HTMLElement)`**: Показывает элемент, удаляя `display` стиль.

- **`protected setImage(element: HTMLImageElement, src: string, alt?: string)`**: Устанавливает источник изображения и альтернативный текст для изображения. Применимо только к элементам `HTMLImageElement`.

- **`render(data?: Partial<T>): HTMLElement`**: Обновляет данные в представлении, устанавливая свойства из объекта `data`. Возвращает контейнер элемента.

## Зависимости

- **`IEvents`**: Интерфейс для управления событиями.

# Файл `vmodal.ts`

## Описание

Файл `vmodal.ts` содержит класс `CardModal`, который представляет модальное окно в приложении. Этот класс управляет открытием и закрытием модального окна, а также настройкой его содержания.

## Класс `CardModal<T>`

### Свойства

- **`_content`**: DOM элемент, представляющий содержание модального окна (`HTMLElement`).

- **`_buttonClose`**: DOM элемент кнопки закрытия модального окна (`HTMLButtonElement`).

### Конструктор

- **`constructor(container: HTMLElement, events: IEvents)`**: Инициализирует экземпляр класса `CardModal`. Устанавливает ссылки на элементы содержания и кнопку закрытия, а также добавляет обработчики событий для закрытия модального окна.

### Методы

- **`open()`**: Открывает модальное окно, добавляя класс `modal_active` к контейнеру и эмитирует событие `modal:open`.

- **`close()`**: Закрывает модальное окно, удаляя класс `modal_active` из контейнера и эмитирует событие `modal:close`.

- **`set content(value: HTMLElement)`**: Устанавливает содержание модального окна, заменяя текущее содержание новым элементом.

## Зависимости

- **`ensureElement`**: Функция для нахождения и проверки наличия DOM элементов.
- **`IEvents`**: Интерфейс для управления событиями.
- **`View`**: Базовый класс для представлений, предоставляющий методы для управления DOM элементами.

# Слой Presenter

# Файл `index.ts`

## Описание

Файл `index.ts` реализует презентер приложения, который управляет всеми ключевыми функциями интерфейса. Он отвечает за инициализацию данных и представлений, обработку пользовательских событий, взаимодействие с API и обновление интерфейса в зависимости от изменений состояния приложения.

## Основные компоненты

### Инициализация данных

- **`events`**: Экземпляр `EventEmitter`, который управляет событиями в приложении.
- **`productData`**: Экземпляр `ProductItem`, который управляет данными о товарах.
- **`basketData`**: Экземпляр `ShoppingCart`, который управляет данными корзины.
- **`orderData`**: Экземпляр `Order`, который управляет данными заказа.
- **`orderSuccess`**: Экземпляр `Success`, который управляет данными успешного завершения заказа.

### Инициализация элементов представления

- **`elements`**: Объект, содержащий ссылки на ключевые элементы интерфейса и шаблоны.
- **`views`**: Объект, содержащий экземпляры различных представлений, таких как страница, модальное окно, карточка товара, корзина и форма заказа.

### Получение экземпляра API

- **`api`**: Экземпляр `AppApi`, который взаимодействует с сервером для получения и отправки данных.

### Основные обработчики событий

- **`loadProducts()`**: Асинхронная функция для загрузки данных о товарах и обновления интерфейса.
- **`events.on('cards:changed')`**: Обработчик события, обновляющий список товаров на странице при изменении данных о товарах.
- **`events.on('productModal:open')`**: Обработчик события, открывающий модальное окно с подробной информацией о товаре.
- **`events.on('viewCard:addToBasket')`**: Обработчик события, добавляющий товар в корзину.
- **`events.on('viewCard:deleteFromBasket')`**: Обработчик события, удаляющий товар из корзины.
- **`events.on('basketData:changed')`**: Обработчик события, обновляющий данные корзины и отображение изменений.
- **`events.on('viewBasket:open')`**: Обработчик события, открывающий модальное окно с корзиной.
- **`events.on('order:open')`**: Обработчик события, открывающий модальное окно с формой заказа.
- **`events.on('order:submit')`**: Обработчик события, отправляющий заказ и открывающий форму контактов.
- **`events.on('contacts:submit')`**: Обработчик события, отправляющий контактные данные и завершающий заказ.
- **`events.on('success:submit')`**: Обработчик события, закрывающий модальное окно после успешного завершения заказа.

### Инициализация приложения

- **`loadProducts()`**: Вызов функции для загрузки данных о товарах при инициализации приложения.

## Зависимости

- **`EventEmitter`**: Компонент для управления событиями.
- **`ProductItem`**, **`ShoppingCart`**, **`Order`**, **`Success`**: Компоненты для управления данными о товарах, корзине, заказах и успешном завершении.
- **`Page`**, **`ProductPreview`**, **`Basket`**, **`FormOrder`**, **`FormContacts`**, **`VSuccess`**, **`CardModal`**, **`Modal`**: Представления для отображения различных частей интерфейса.
- **`AppApi`**: Компонент для взаимодействия с API сервера.
- **`cloneTemplate`**, **`ensureElement`**: Утилиты для работы с DOM и шаблонами.
